//go:build amd64

package search

import "testing"

func TestCosineMagnitude_Avx2(t *testing.T) {
	var tests = []struct {
		v      []float32
		output float32
	}{
		{v: []float32{1, 2, 3, 4, 8},
			output: 9.695,
		},
		{v: []float32{1, 2, 3},
			output: 3.741},
		{v: []float32{1, 2, 3, 4},
			output: 5.477},

		{v: []float32{-0.48152837, -0.9233136, -3.2174091, 0.18817312, 1.0239712, 0.537516, -0.1355207, 1.2107713, -0.16657588, -0.75681144, -0.5795268, -0.7529298, 0.7570292, -1.4908372, -0.92496884, -2.0757003, -1.0849329, -0.06319283, 0.89413524, 0.15037605, -0.8991889, -0.1384988, 0.3735187, 0.9532701, 3.7232246, 0.6240758, 1.2555892, -0.40052778, -0.78026164, 0.78998053, 0.8411393, -0.7796171, -0.081749454, 0.20354177, 1.6018617, -1.2285175, -0.52918386, 0.6926404, 0.6901233, -0.5641664, 0.52443236, -0.8759955, 0.4798163, 0.024029626, 2.5422654, -1.6009299, -0.2767235, 0.40043604, 0.9862171, -0.15648642, -0.62372494, 0.53350985, 1.3108852, 0.11291069, 2.488056, -0.27698934, 0.69433826, -1.7402563, 0.33753332, 0.8440583, 1.0157287, 1.664056, 0.5567892, 1.3590034, 0.5874456, -0.1302745, -0.18488652, 1.0962113, -0.07639228, -1.5551255, 0.90824217, 0.9435294, 0.24992238, 0.046190158, 0.9796589, 0.15338026, 0.33330208, -0.595007, 0.3785809, 0.755604, 0.60600674, -0.7329147, 0.63378763, 0.4955551, 0.30737805, 0.033930197, 0.05713391, -0.47152558, -0.24528675, -0.11068135, 0.649512, 1.21314, 1.2610705, 0.20822904, -1.4788649, 0.13393652, 0.72075874, 0.3123695, -0.12744737, -0.9181958, 0.68768495, 0.98774797, -0.18158372, -0.24322316, 1.4179947, 0.41308767, 0.22775759, -1.1111484, -0.9217407, 0.40848225, -0.45400017, 1.1362616, 0.29854506, -0.8821255, 0.19714928, 0.8859011, -0.4426835, -1.6458354, 0.33348596, 0.8533795, -0.70031506, -1.4923981, 0.8635303, 1.0468464, 0.10373614, 0.4509778, -0.5181635, 0.059868157, 0.19541834, -0.25151467, 0.77375585, -1.2270973, 0.043475877, 0.1801568, -0.24104616, 1.4657254, -0.83110875, -2.200087, -0.6295781, 0.23697604, 1.3182279, 0.21964897, 0.15949953, -0.9891008, 0.9379275, -1.9905164, 0.44799554, -1.3846635, -0.19984552, -0.083180286, -0.039368667, 0.4008065, -0.61750543, 0.10130224, 0.9562229, -0.70481336, -0.3071887, 0.33269727, 1.0820564, -0.87225217, 0.27949533, -1.3149992, 0.47651798, -0.13200113, 0.09143972, -1.6568116, -0.6010761, 0.44805658, 0.3558244, -0.6143907, -1.4535742, -1.1309178, 0.9347337, 0.4499147, -0.4877949, -0.19307737, -0.7422137, 0.021937797, 0.73073286, -0.6531677, -0.08348158, -0.123009026, 0.24812672, 0.8222479, -0.67936754, -0.03646995, -1.554987, -0.3448236, -1.3641866, -0.15069401, 0.47042373, -0.15818714, -0.8095279, -1.7079018, -1.0239773, 0.9145745, 0.30216333, 0.902673, 1.0572184, -0.46377444, 0.32772428, 0.23604411, 1.9226086, -0.7618908, -1.3991809, 0.737344, -0.12671286, 0.48509648, 0.07830081, 0.27150762, 0.22425711, -0.21474972, -0.5408262, 0.7366384, 0.50044435, -0.63421607, 0.49235535, -0.08361161, 0.73284197, 0.56537354, 0.29506716, -0.35788256, 0.06534785, -0.7014859, 0.71503305, 0.120099135, -1.330863, -0.7765596, 0.3203357, -0.13024248, -0.09789792, -2.3026602, -0.0858212, 0.66458344, -0.021387637, 0.58201754, -0.009115983, 0.298184, 0.32770485, -0.61347353, -0.75143254, 0.87891984, -0.27242887, -0.5693034, -1.609992, 0.7793802, 0.27315345, -0.9728371, 0.28884837, 0.2025704, -2.477388, -0.020010546, 0.83945143, 0.85488814, 0.9491195, -0.46582282, 0.046570983, 0.61150867, 0.73044956, -0.6849804, 0.3089575, -0.007435011, 0.9408022, -0.03378077, 0.558615, 1.5931356, -0.7759814, -0.26532048, 0.25314063, -0.9441165, -0.21081485, 0.26620007, -1.0742505, 1.3613102, 0.078597054, -1.2300674, 0.7206876, 0.26140505, -1.526103, 0.23775779, 0.64223135, 0.016841117, -0.88364244, -0.6217705, 0.5679086, -0.9033274, 0.22036605, 0.4990582, -0.3167125, -0.2735901, 0.45441318, 1.0462785, 0.5965737, -0.51666975, 0.13218132, 0.86853504, 1.4398018, 0.2740142, 0.25748384, -0.2697761, 0.9442301, -0.6055231, 1.4126737, -0.37891597, 0.44880587, 0.009073608, 0.55473304, -0.940343, 0.76804966, 0.007302016, -0.6087611, 1.9026344, -0.9128766, 0.49901897, -1.739627, 0.63540435, 1.0969976, -0.9523704, 1.2098573, -0.7476375, 0.15766582, -0.5439461, 0.25082344, -0.2778067, -0.36674824, 0.15191577, 0.043076668, 0.12959833, 1.2371875, -0.9153108, -0.5982144, 0.8991062, -0.68823564, -1.0923796, -0.4667385, 0.42403018, -0.092934765, -0.7243048, -0.24628131, 0.6174033, -0.4420874, -1.2254388, 0.4835207, -1.472428, -0.8337005, 0.3752591, 0.09067496, 0.20247367, 0.67010164, -0.42029774, -0.19049674, -0.036616683, -1.2667367, 0.083018444, -0.3246094, -0.4982129, 0.08512106, 1.3069637, 0.20103371, -0.43868005, 0.5997726, -1.2203635, 0.8010277, -0.8870668, -0.4821588, 0.96218216, 0.7868718, -0.16525218, 0.676179, -0.74215317, -1.3567107, -0.94742537, 0.047654904, 0.49878678, 0.35454756, -0.1907419, -0.90546227, 0.85048485, 0.2895674, 1.571914, 0.14620215, -0.12404446, -0.867313, -0.060033634, 0.44291633, 0.07850296, -0.9937012, -0.42930907, -0.27286363, 1.4816728, -0.72327566, -1.5155468, 0.8064755, 0.40818477, -0.3107036, -0.6801929, 0.6732247, -0.785411, -1.0793654, 0.25419238, -1.033352, -1.4140966, -0.12748173, -0.51928407, 0.9674828, -0.4260699, -1.8771431, -0.5483761, 0.1457074, -0.34260362, 0.6637039, 0.9944253, -0.5000242, -1.3535061, -1.310367, 1.5137237, 2.063428, -1.3627845, -0.27402556, 1.1285495, 1.1935613, 1.751186, -0.37801105, -0.122339204, 0.8697192, 0.27019858, -0.12050609, 0.2514539, -0.213761, -0.98292476, 0.11860454, -0.5062104, 0.62642336, 0.3798346, -0.62619644, -0.63480115, 0.6145363, 0.15920027, 1.0346069, 1.271251, -0.6315867, -1.2108663, 0.57045764, -0.98329866, -0.44920292, 1.380247, 0.35425717, 0.27412575, -0.02665345, -0.11358385, 0.13299659, 0.6706591, 1.0233626, 0.30069482, 1.0516145, 0.49312574, -0.1867784, 0.7270293, -0.12394741, 1.8350058, 1.2667503, 0.10459163, -1.8404145, 0.6131768, 0.5385249, -1.2097481, -0.47319415, 0.99665093, -0.33528334, -0.5780113, -0.63881385, 1.3345476, -0.8225533, -0.29508072, -0.9633077, 0.6717504, -0.37589532, 0.41233152, -0.9535013, 0.44962043, -0.32348135, -0.6494948, -1.621438, -0.861135, 0.72502595, -0.16735303, 0.53825355, -0.7820088, 1.1519063, -1.6217488, 1.2226305, 1.7184869, 1.0873506, 0.50660473, -0.14451276, -1.316133, 0.22886144, 0.2928434, -0.6059728, -0.9244834, 1.4458643, 0.0726026, -0.290402, 0.19633989, 1.7361274, 0.17787883, -0.4467752, -1.4312496, -1.1792798, 0.6568744, -0.2353363, -0.43751293, 1.3941282, 0.13718261, 1.512648, 0.31169397, 0.46392092, -0.5926447, -0.6842333, -0.5387211, 0.77969503, -0.46056294, -1.5320672, -0.34597594, -0.93019044, 1.5610873, 0.9481094, -1.0305047, -0.643654, -0.3292068, 0.6716702, 0.28661674, -1.0739019, -0.8592372, 0.36975443, 0.52222073, -0.92491925, -0.5809222, -0.31007364, 1.1856496, -0.15246537, -1.2889712, -0.099821165, -0.451029, 0.67319465, 0.026079986, 0.21622309, 0.58434415, -0.7867023, -0.12249255, 0.55289614, -0.5527456, -0.7476981, -1.0137091, -0.39940232, -1.0391762, -0.26460105, -1.018, -0.6657628, 0.2771317, 1.6550211, -0.118730865, 0.7123262, 0.7159514, 2.2209885, -0.25631192, -0.5385833, -0.07816545, 0.28483626, 0.47128195, -0.38693196, -0.6112689, -0.64106905, -0.42099273, -0.12876903, 0.44979295, 0.7464367, 0.6973219, -0.1797649, -0.18809746, 0.43090156, -1.4821783, 1.34643, 0.35895646, 0.9858886, -0.21840629, 0.83632267, 0.21678904, -1.326447, -0.8749625, -0.05766727, -1.2058804, -0.39778537, -1.2160727, -0.3623044, -0.10821333, 0.14467457, -0.119695514, -1.813981, 0.10079424, -0.7227745, -0.14535382, 0.7652277, -1.4579706, 0.8609652, 1.5378069, 0.2689542, 0.10737092, -0.25211644, 0.29032755, 0.77771676, 0.5768255, -0.8756928, -0.025279216, 0.18640393, 0.2501849, 1.364368, -1.1608008, -0.04601893, -0.4650988, 0.83899444, -0.8602426, 0.35561138, -0.48252815, 1.8101969, -0.023175277, -0.66762316, -0.42764288, -1.5676253, 2.3226027, -0.09377426, -0.16859365, -1.4371145, -0.6393635, -0.9447458, 0.027634865, 0.4528245, 0.1686412, -0.778491, 0.061765596, 0.71673065, -0.32658687, -0.4728215, 0.029112073, -0.4678592, -0.0921162, 0.22657143, 1.3558004, 1.6546444, -0.12860808, 0.8169991, 0.7899942, -1.502492, 0.2674548, 0.24938937, -0.33215982, 0.89597845, -1.6372502, -0.5381735, -0.025380246, -0.67614436, -0.17595783, -0.5781694, 0.672135, 0.51085097, 0.021413513, 0.9697366, 0.94628876, -1.3035153, -0.8715645, -0.74060833, -0.0239655, -0.19893123, -0.7059541, -0.73656887, 0.51716363, -0.24957384, 0.872674, 1.9182698, -0.0033155065, -0.13848448, -1.4782411, -1.1526804, -0.22785807, 0.5279206, 0.7109796, 1.1145124, -0.35244876, -0.53137267, -0.94762254, 0.084059104, -1.1370723, 1.1415067, 0.15631561, -0.7199638, 0.004645355, 0.055946425, 0.65377164, -0.22102919, -0.048567824, -0.40843403, 0.3958103, 1.095192, 0.9156384, -1.9879025, -0.4727384, -0.2508134, -0.09153135, 0.400618, -0.42410254, 1.2957652, 0.58694494, 1.3448864, 0.015747169, 0.8198134, 0.103170745, -0.27809107, -0.031206653, -0.15289953, -0.29097688, 0.8450918, 0.06475736, -0.7763581, -0.8955928, -0.5786203, 1.9191916, 1.2143033, -1.5647135, 0.28472683, -0.3495334, 1.2365811, 0.3950894, -0.15681648, -0.038230617, -0.60112876, 1.4845955, -0.17692092, 0.4165346, -0.52610874, 1.036766, -0.17338172, -1.8616784, 0.66563106, 0.8475896, -0.57766837, -0.28701025, 0.81126726, 0.66136044, 1.0384926, 0.61120534, -1.1848512, 0.16732666, -1.3054559, 0.47450057, -0.4237256, 0.46354043, -0.21352848, -0.32955757, 1.5729322, 0.32031077, 0.65078527, -0.32270432, 0.66611147, -0.32647175, -0.9348624, -0.26661325, -0.47289985, 0.14995739},
			output: 23.224,
		},
	}
	for _, test := range tests {
		v := Float32s(test.v)
		got := v.MagnitudeAvx2()
		if AlmostEqual(got, test.output, 0.001) {
			t.Errorf("magnitude(%v) = %v, want %v", test.v, got, test.output)
		}
	}
}
